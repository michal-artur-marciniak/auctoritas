{
  "project": "Auctoritas",
  "branchName": "feature/v0-4-1-oauth-additional-providers",
  "description": "v0.4.1 Additional OAuth Providers - Add GitHub, Apple, Microsoft, and Facebook via a shared provider abstraction and consistent linking rules.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add OAuth provider abstraction and registry",
      "description": "As a developer, I want a provider interface so that adding providers is consistent and maintainable.",
      "acceptanceCriteria": [
        "Create a provider interface with methods needed for authorize URL creation and callback token exchange",
        "Implement a provider factory/registry keyed by provider name",
        "Existing Google provider uses the same abstraction",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement unified account linking rules for OAuth callbacks",
      "description": "As the platform, I want consistent account linking rules so that provider logins map to the correct user.",
      "acceptanceCriteria": [
        "If an OAuth connection exists for provider+provider_user_id, it is used",
        "Otherwise, if provider returns a verified email and a user exists with that email in the project, link to that user",
        "Otherwise create a new user and mark emailVerified=true only when provider asserts verified email",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Add GitHub OAuth project configuration",
      "description": "As a project admin, I want GitHub sign-in configurable per project so that users can authenticate via GitHub.",
      "acceptanceCriteria": [
        "Project settings support GitHub fields: enabled, clientId, clientSecret, redirectUris",
        "clientSecret is stored encrypted at rest and never returned in full via API",
        "Redirect URIs are validated against the project's allowlist for GitHub",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Implement GitHub OAuth provider end-to-end",
      "description": "As a project admin, I want GitHub sign-in working so that users can authenticate via GitHub.",
      "acceptanceCriteria": [
        "Authorize/callback endpoints support provider=github using the shared provider abstraction",
        "End-to-end flow works: /authorize -> GitHub -> /callback -> redirect with auctoritas_code -> exchange",
        "OAuth connection is persisted under provider github",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Add Microsoft OAuth project configuration",
      "description": "As a project admin, I want Microsoft sign-in configurable per project so that users can authenticate via Microsoft.",
      "acceptanceCriteria": [
        "Project settings support Microsoft fields: enabled, clientId, clientSecret, tenant (if applicable), redirectUris",
        "clientSecret is stored encrypted at rest and never returned in full via API",
        "Redirect URIs are validated against the project's allowlist for Microsoft",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement Microsoft OAuth provider end-to-end",
      "description": "As a project admin, I want Microsoft sign-in working so that users can authenticate via Microsoft accounts.",
      "acceptanceCriteria": [
        "Authorize/callback endpoints support provider=microsoft using the shared provider abstraction",
        "End-to-end flow works: /authorize -> Microsoft -> /callback -> redirect with auctoritas_code -> exchange",
        "OAuth connection is persisted under provider microsoft",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Add Facebook OAuth project configuration",
      "description": "As a project admin, I want Facebook sign-in configurable per project so that users can authenticate via Facebook.",
      "acceptanceCriteria": [
        "Project settings support Facebook fields: enabled, clientId, clientSecret, redirectUris",
        "clientSecret is stored encrypted at rest and never returned in full via API",
        "Redirect URIs are validated against the project's allowlist for Facebook",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Implement Facebook OAuth provider end-to-end",
      "description": "As a project admin, I want Facebook sign-in working so that users can authenticate via Facebook.",
      "acceptanceCriteria": [
        "Authorize/callback endpoints support provider=facebook using the shared provider abstraction",
        "End-to-end flow works: /authorize -> Facebook -> /callback -> redirect with auctoritas_code -> exchange",
        "OAuth connection is persisted under provider facebook",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Add Apple Sign-In project configuration",
      "description": "As a project admin, I want Apple sign-in configurable per project so that users can authenticate via Apple.",
      "acceptanceCriteria": [
        "Project settings support Apple fields required for server-side flow (e.g., teamId, keyId, serviceId, privateKey or reference, redirectUris)",
        "Apple secrets/keys are stored encrypted at rest and never returned in full via API",
        "Redirect URIs are validated against the project's allowlist for Apple",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Implement Apple Sign-In provider end-to-end",
      "description": "As a project admin, I want Apple sign-in working so that users can authenticate via Apple.",
      "acceptanceCriteria": [
        "Authorize/callback endpoints support provider=apple using the shared provider abstraction",
        "Apple-specific constraints are handled (e.g., ID token validation) while keeping the same redirect + exchange pattern",
        "OAuth connection is persisted under provider apple",
        "mvn -pl backend/services/auth-service test passes",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    }
  ]
}
