## Codebase Patterns
- Auth-service database migrations live in `backend/services/auth-service/src/main/resources/db/migration` and use Flyway `V{n}__description.sql` naming.
- Project creation flows initialize `ProjectSettings` and a default API key via `ApiKeyService`.
- Soft-deleting projects sets `ProjectStatus.DELETED` and revokes API keys via `ApiKeyService.revokeAllByProjectId`.
- Project settings responses are mapped via `ProjectService.toSettingsResponse`, with OAuth config stored on `ProjectSettings.oauthConfig` as JSON.

## 2026-01-26 15:36 - US-001
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Moved project settings to be keyed by `project_id` with a new migration and updated JPA mappings/tests.
- Files changed: `backend/services/auth-service/src/main/resources/db/migration/V4__project_settings_project_id.sql`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/entity/project/Project.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/entity/project/ProjectSettings.java`, `backend/services/auth-service/src/test/java/dev/auctoritas/auth/repository/ProjectRepositoryTest.java`, `backend/services/auth-service/src/test/java/dev/auctoritas/auth/repository/ProjectSettingsRepositoryTest.java`, `prd.json`.
- **Learnings for future iterations:**
  - Patterns discovered: project settings are now owned by `ProjectSettings.project` via the `project_id` foreign key.
  - Gotchas encountered: tests must persist a `Project` with linked settings since `project_id` is required.
  - Useful context: cascade persistence is handled from `Project` to `ProjectSettings` when both sides are linked.
---

## 2026-01-26 15:45 - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented project creation/list APIs with default project settings plus one-time API key response.
- Files changed: `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectController.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectCreateRequest.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectCreateResponse.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectSummaryResponse.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ApiKeySecretResponse.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/service/ApiKeyService.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/service/ProjectService.java`, `prd.json`, `progress.txt`.
- **Learnings for future iterations:**
  - Patterns discovered: API key creation uses a SHA-256 hash of the full key (prefix + token) and returns the raw key only once.
  - Gotchas encountered: project creation should attach `ProjectSettings` on the `Project` entity before saving to satisfy the `project_id` constraint.
  - Useful context: project listing uses `ProjectRepository.findAllByOrganizationId` and maps to `ProjectSummaryResponse`.
---

## 2026-01-26 15:55 - US-003
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented project update/delete endpoints with status updates and API key revocation on delete.
- Files changed: `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectController.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectUpdateRequest.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/service/ProjectService.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/service/ApiKeyService.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/repository/ApiKeyRepository.java`, `prd.json`, `progress.txt`.
- **Learnings for future iterations:**
  - Patterns discovered: use `ProjectService.loadProject` to enforce org ownership checks and 404 on mismatches.
  - Gotchas encountered: slug updates must check uniqueness only when the normalized slug changes.
  - Useful context: project deletion revokes API keys by updating status to `REVOKED` via a repository bulk update.
---

## 2026-01-26 16:04 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented project settings endpoints for fetching and updating password, session, and OAuth configuration.
- Files changed: `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectController.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectOAuthSettingsRequest.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectPasswordSettingsRequest.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectSessionSettingsRequest.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/api/ProjectSettingsResponse.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/entity/project/ProjectSettings.java`, `backend/services/auth-service/src/main/java/dev/auctoritas/auth/service/ProjectService.java`, `backend/services/auth-service/src/main/resources/db/migration/V5__project_settings_oauth_config.sql`, `prd.json`, `progress.txt`.
- **Learnings for future iterations:**
  - Patterns discovered: project settings are updated through dedicated request records and returned as `ProjectSettingsResponse` from `ProjectService`.
  - Gotchas encountered: H2 schema generation requires JSON column definitions compatible with the test dialect.
  - Useful context: OAuth configuration is stored on `ProjectSettings.oauthConfig` as a JSON column.
---
