{
  "project": "Auctoritas",
  "branchName": "feature/orgs-projects-environments",
  "description": "Organizations with fixed PROD/DEV environments, API-key scoped SDK auth, and org-member dashboard auth.",
  "architecturalMapping": {
    "overview": "Organization/project/environment features follow Hexagonal Architecture (Ports/Adapters) and the existing DDD layering in apps/api."
  },
  "domainLayer": {
    "aggregates": [
      {
        "name": "Organization",
        "description": "Billing and administrative boundary that owns projects and members.",
        "factoryMethods": [
          "create(name, slug, ownerEmail, ownerName, ownerPasswordHash)",
          "rename(name)",
          "suspend()",
          "activate()"
        ],
        "invariants": [
          "Organization slug is unique",
          "Organization status must be ACTIVE or SUSPENDED",
          "Owner role is required at creation"
        ],
        "entities": [
          {
            "name": "OrganizationMember",
            "description": "Dashboard user with org-scoped role.",
            "invariants": [
              "Member email is unique within organization",
              "Role must be OWNER, ADMIN, or MEMBER",
              "Members must belong to exactly one organization"
            ]
          },
          {
            "name": "OrganizationInvitation",
            "description": "Invitation token for onboarding members.",
            "invariants": [
              "Invitation token is unique",
              "Invitation must have a future expiry",
              "Invitation role must be OWNER, ADMIN, or MEMBER"
            ]
          }
        ]
      },
      {
        "name": "Project",
        "description": "Logical app boundary under an organization, scoped to fixed environments.",
        "factoryMethods": [
          "create(organizationId, name, slug, description, createdBy)",
          "rename(name)",
          "updateDescription(description)",
          "archive()"
        ],
        "invariants": [
          "Project slug is unique per organization",
          "Project must belong to exactly one organization",
          "Archived projects are read-only"
        ]
      },
      {
        "name": "Environment",
        "description": "Immutable environment for a project.",
        "factoryMethods": [
          "create(projectId, environmentType)"
        ],
        "invariants": [
          "Only PROD and DEV are allowed",
          "Each project can have at most one PROD and one DEV",
          "Environment type cannot change after creation"
        ]
      },
      {
        "name": "ApiKey",
        "description": "API key bound to a project environment for SDK authentication.",
        "factoryMethods": [
          "generate(projectId, environmentId, name, createdBy)",
          "revoke(revokedAt)"
        ],
        "invariants": [
          "Key hash is unique",
          "Key prefix matches environment type (pk_prod_, pk_dev_)",
          "Revoked keys cannot be reused"
        ]
      }
    ],
    "valueObjects": [
      {
        "name": "OrganizationId",
        "description": "Typed UUID for organizations"
      },
      {
        "name": "OrganizationSlug",
        "description": "Validates org slug format and length"
      },
      {
        "name": "ProjectId",
        "description": "Typed UUID for projects"
      },
      {
        "name": "ProjectSlug",
        "description": "Validates project slug format and uniqueness per org"
      },
      {
        "name": "EnvironmentType",
        "description": "Enum value for PROD or DEV"
      },
      {
        "name": "ApiKeyPrefix",
        "description": "Validates key prefix matches environment type"
      }
    ],
    "domainServices": [
      {
        "name": "ProjectProvisioningDomainService",
        "description": "Creates fixed environments and initial API keys for a new project"
      },
      {
        "name": "ApiKeyGenerationDomainService",
        "description": "Generates key material, hashes, prefixes, and timestamps"
      },
      {
        "name": "ProjectContextResolutionDomainService",
        "description": "Resolves project + environment from API key"
      }
    ],
    "domainEvents": [
      {
        "name": "OrganizationCreatedEvent",
        "description": "Published when organization and owner are created",
        "properties": [
          "organizationId",
          "ownerMemberId",
          "name",
          "slug"
        ]
      },
      {
        "name": "OrganizationMemberInvitedEvent",
        "description": "Published when a member invitation is created",
        "properties": [
          "organizationId",
          "invitationId",
          "email",
          "role"
        ]
      },
      {
        "name": "OrganizationMemberRoleChangedEvent",
        "description": "Published when a member role changes",
        "properties": [
          "organizationId",
          "memberId",
          "role"
        ]
      },
      {
        "name": "ProjectCreatedEvent",
        "description": "Published when a project is created",
        "properties": [
          "organizationId",
          "projectId",
          "name",
          "slug"
        ]
      },
      {
        "name": "ProjectEnvironmentsCreatedEvent",
        "description": "Published when PROD/DEV environments are created",
        "properties": [
          "projectId",
          "environmentIds"
        ]
      },
      {
        "name": "ApiKeyCreatedEvent",
        "description": "Published when an API key is generated",
        "properties": [
          "projectId",
          "environmentId",
          "apiKeyId",
          "keyPrefix"
        ]
      },
      {
        "name": "ApiKeyRevokedEvent",
        "description": "Published when an API key is revoked",
        "properties": [
          "apiKeyId",
          "projectId",
          "environmentId"
        ]
      }
    ],
    "repositoryPorts": [
      {
        "name": "OrganizationRepositoryPort",
        "methods": [
          "findById",
          "findBySlug",
          "save",
          "update"
        ]
      },
      {
        "name": "OrganizationMemberRepositoryPort",
        "methods": [
          "findById",
          "findByEmailAndOrganizationId",
          "listByOrganizationId",
          "save",
          "delete"
        ]
      },
      {
        "name": "OrganizationInvitationRepositoryPort",
        "methods": [
          "findByToken",
          "save",
          "deleteExpired"
        ]
      },
      {
        "name": "ProjectRepositoryPort",
        "methods": [
          "findById",
          "findBySlugAndOrganizationId",
          "listByOrganizationId",
          "save",
          "update"
        ]
      },
      {
        "name": "EnvironmentRepositoryPort",
        "methods": [
          "listByProjectId",
          "saveAll",
          "findByProjectIdAndType"
        ]
      },
      {
        "name": "ApiKeyRepositoryPort",
        "methods": [
          "findByKeyHash",
          "listByProjectId",
          "save",
          "revoke"
        ]
      },
      {
        "name": "UserRepositoryPort",
        "methods": [
          "findByEmailAndProjectId",
          "findByIdAndProjectId",
          "save"
        ]
      }
    ]
  },
  "applicationLayer": {
    "useCases": [
      {
        "id": "UC-ORG-001",
        "name": "CreateOrganizationUseCase",
        "implements": "OrganizationManagementPort",
        "userStory": "US-001",
        "orchestration": [
          "Validate org name and slug uniqueness",
          "Create organization and owner member",
          "Persist via OrganizationRepositoryPort",
          "Publish OrganizationCreatedEvent"
        ]
      },
      {
        "id": "UC-ORG-002",
        "name": "GetOrganizationUseCase",
        "implements": "OrganizationQueryPort",
        "userStory": "US-001",
        "orchestration": [
          "Validate org member access",
          "Load organization and summary",
          "Return organization details"
        ]
      },
      {
        "id": "UC-ORG-003",
        "name": "UpdateOrganizationUseCase",
        "implements": "OrganizationManagementPort",
        "userStory": "US-001",
        "orchestration": [
          "Validate org member access (OWNER/ADMIN)",
          "Apply org updates",
          "Persist via OrganizationRepositoryPort"
        ]
      },
      {
        "id": "UC-ORG-004",
        "name": "InviteMemberUseCase",
        "implements": "OrganizationMemberPort",
        "userStory": "US-002",
        "orchestration": [
          "Validate org member access (OWNER/ADMIN)",
          "Validate email uniqueness within org",
          "Create invitation token with expiry",
          "Persist invitation and publish OrganizationMemberInvitedEvent"
        ]
      },
      {
        "id": "UC-ORG-005",
        "name": "AcceptInvitationUseCase",
        "implements": "OrganizationMemberPort",
        "userStory": "US-002",
        "orchestration": [
          "Validate invitation token and expiry",
          "Create org member from invitation",
          "Persist member and delete invitation"
        ]
      },
      {
        "id": "UC-ORG-006",
        "name": "ChangeMemberRoleUseCase",
        "implements": "OrganizationMemberPort",
        "userStory": "US-002",
        "orchestration": [
          "Validate org member access (OWNER)",
          "Update role and persist",
          "Publish OrganizationMemberRoleChangedEvent"
        ]
      },
      {
        "id": "UC-ORG-007",
        "name": "RemoveMemberUseCase",
        "implements": "OrganizationMemberPort",
        "userStory": "US-002",
        "orchestration": [
          "Validate org member access (OWNER/ADMIN)",
          "Ensure not removing last OWNER",
          "Delete member"
        ]
      },
      {
        "id": "UC-AUTH-001",
        "name": "OrgMemberLoginUseCase",
        "implements": "OrgAuthPort",
        "userStory": "US-006",
        "orchestration": [
          "Validate credentials",
          "Issue org JWT",
          "Update last_login_at"
        ]
      },
      {
        "id": "UC-AUTH-002",
        "name": "RefreshOrgTokenUseCase",
        "implements": "OrgAuthPort",
        "userStory": "US-006",
        "orchestration": [
          "Validate refresh token",
          "Issue new org JWT"
        ]
      },
      {
        "id": "UC-PROJ-001",
        "name": "CreateProjectUseCase",
        "implements": "ProjectManagementPort",
        "userStory": "US-003",
        "orchestration": [
          "Validate org member access (OWNER/ADMIN)",
          "Create project",
          "Create PROD/DEV environments",
          "Generate API keys for both environments",
          "Persist and publish ProjectCreatedEvent"
        ]
      },
      {
        "id": "UC-PROJ-002",
        "name": "ListOrganizationProjectsUseCase",
        "implements": "ProjectQueryPort",
        "userStory": "US-003",
        "orchestration": [
          "Validate org member access",
          "Load projects by organization",
          "Return summaries with environment status"
        ]
      },
      {
        "id": "UC-PROJ-003",
        "name": "GetProjectUseCase",
        "implements": "ProjectQueryPort",
        "userStory": "US-003",
        "orchestration": [
          "Validate org member access",
          "Load project and environments",
          "Return project detail"
        ]
      },
      {
        "id": "UC-PROJ-004",
        "name": "ArchiveProjectUseCase",
        "implements": "ProjectManagementPort",
        "userStory": "US-003",
        "orchestration": [
          "Validate org member access (OWNER/ADMIN)",
          "Archive project",
          "Persist updates"
        ]
      },
      {
        "id": "UC-KEY-001",
        "name": "ListProjectApiKeysUseCase",
        "implements": "ApiKeyManagementPort",
        "userStory": "US-007",
        "orchestration": [
          "Validate org member access",
          "List API keys for project",
          "Return redacted key metadata"
        ]
      },
      {
        "id": "UC-KEY-002",
        "name": "RotateProjectApiKeyUseCase",
        "implements": "ApiKeyManagementPort",
        "userStory": "US-007",
        "orchestration": [
          "Validate org member access (OWNER/ADMIN)",
          "Generate new key for environment",
          "Revoke old key",
          "Return new key value"
        ]
      },
      {
        "id": "UC-CTX-001",
        "name": "ResolveProjectContextUseCase",
        "implements": "ProjectContextPort",
        "userStory": "US-004",
        "orchestration": [
          "Hash incoming API key",
          "Lookup ApiKey by hash",
          "Return projectId and environmentId"
        ]
      },
      {
        "id": "UC-SDK-001",
        "name": "RegisterEndUserUseCase",
        "implements": "SdkAuthPort",
        "userStory": "US-004",
        "orchestration": [
          "Validate API key context",
          "Create end user scoped to project/environment",
          "Issue SDK JWT"
        ]
      },
      {
        "id": "UC-SDK-002",
        "name": "LoginEndUserUseCase",
        "implements": "SdkAuthPort",
        "userStory": "US-004",
        "orchestration": [
          "Validate API key context",
          "Validate end user credentials",
          "Issue SDK JWT"
        ]
      },
      {
        "id": "UC-SDK-003",
        "name": "GetCurrentUserUseCase",
        "implements": "SdkUserPort",
        "userStory": "US-005",
        "orchestration": [
          "Validate SDK JWT",
          "Load user scoped to project context",
          "Return profile"
        ]
      }
    ],
    "outboundPorts": [
      {
        "name": "ApiKeyHasherPort",
        "description": "Hashes raw API keys for storage and lookup"
      },
      {
        "name": "JwtIssuerPort",
        "description": "Issues JWTs for org members and SDK users"
      },
      {
        "name": "DomainEventPublisherPort",
        "description": "Publishes organization/project events for audit and analytics"
      }
    ]
  },
  "adapterLayer": {
    "inbound": {
      "webControllers": [
        {
          "name": "OrganizationController",
          "basePath": "/api/v1/org",
          "endpoints": [
            "POST /register",
            "GET /{orgId}",
            "PUT /{orgId}"
          ],
          "mapsToUseCases": [
            "UC-ORG-001",
            "UC-ORG-002",
            "UC-ORG-003"
          ]
        },
        {
          "name": "OrganizationAuthController",
          "basePath": "/api/v1/org/auth",
          "endpoints": [
            "POST /login",
            "POST /refresh"
          ],
          "mapsToUseCases": [
            "UC-AUTH-001",
            "UC-AUTH-002"
          ]
        },
        {
          "name": "OrganizationMemberController",
          "basePath": "/api/v1/org/{orgId}/members",
          "endpoints": [
            "POST /invite",
            "POST /accept",
            "PUT /{memberId}/role",
            "DELETE /{memberId}"
          ],
          "mapsToUseCases": [
            "UC-ORG-004",
            "UC-ORG-005",
            "UC-ORG-006",
            "UC-ORG-007"
          ]
        },
        {
          "name": "ProjectController",
          "basePath": "/api/v1/org/{orgId}/projects",
          "endpoints": [
            "POST /",
            "GET /",
            "GET /{projectId}",
            "PUT /{projectId}",
            "DELETE /{projectId}"
          ],
          "mapsToUseCases": [
            "UC-PROJ-001",
            "UC-PROJ-002",
            "UC-PROJ-003",
            "UC-PROJ-004"
          ]
        },
        {
          "name": "ProjectApiKeyController",
          "basePath": "/api/v1/org/{orgId}/projects/{projectId}/keys",
          "endpoints": [
            "GET /",
            "POST /"
          ],
          "mapsToUseCases": [
            "UC-KEY-001",
            "UC-KEY-002"
          ]
        },
        {
          "name": "SdkAuthController",
          "basePath": "/api/v1/auth",
          "endpoints": [
            "POST /register",
            "POST /login"
          ],
          "mapsToUseCases": [
            "UC-SDK-001",
            "UC-SDK-002"
          ]
        },
        {
          "name": "SdkUserController",
          "basePath": "/api/v1/users/me",
          "endpoints": [
            "GET /"
          ],
          "mapsToUseCases": [
            "UC-SDK-003"
          ]
        }
      ]
    },
    "outbound": {
      "persistenceAdapters": [
        {
          "name": "OrganizationJpaRepositoryAdapter",
          "implements": "OrganizationRepositoryPort",
          "entity": "Organization"
        },
        {
          "name": "OrganizationMemberJpaRepositoryAdapter",
          "implements": "OrganizationMemberRepositoryPort",
          "entity": "OrganizationMember"
        },
        {
          "name": "OrganizationInvitationJpaRepositoryAdapter",
          "implements": "OrganizationInvitationRepositoryPort",
          "entity": "OrganizationInvitation"
        },
        {
          "name": "ProjectJpaRepositoryAdapter",
          "implements": "ProjectRepositoryPort",
          "entity": "Project"
        },
        {
          "name": "EnvironmentJpaRepositoryAdapter",
          "implements": "EnvironmentRepositoryPort",
          "entity": "Environment"
        },
        {
          "name": "ApiKeyJpaRepositoryAdapter",
          "implements": "ApiKeyRepositoryPort",
          "entity": "ApiKey"
        },
        {
          "name": "UserJpaRepositoryAdapter",
          "implements": "UserRepositoryPort",
          "entity": "User"
        }
      ],
      "securityAdapters": [
        {
          "name": "OrgMemberAuthenticationFilter",
          "implements": "Org JWT auth",
          "notes": "Protects /api/v1/org/** endpoints"
        },
        {
          "name": "ApiKeyAuthenticationFilter",
          "implements": "API key auth",
          "notes": "Protects /api/v1/auth/** endpoints"
        },
        {
          "name": "ProjectContextFilter",
          "implements": "Project context injection",
          "notes": "Resolves project and environment from API key"
        }
      ],
      "messagingAdapters": [
        {
          "name": "OrgDomainEventPublisherAdapter",
          "implements": "DomainEventPublisherPort",
          "description": "Publishes org and project events for audit logging"
        }
      ]
    }
  },
  "dataModel": {
    "tables": [
      {
        "name": "organizations",
        "columns": [
          {
            "name": "id",
            "type": "UUID",
            "pk": true
          },
          {
            "name": "name",
            "type": "VARCHAR(100)"
          },
          {
            "name": "slug",
            "type": "VARCHAR(50)",
            "unique": true
          },
          {
            "name": "status",
            "type": "VARCHAR(20)",
            "default": "ACTIVE"
          },
          {
            "name": "stripe_customer_id",
            "type": "VARCHAR(100)",
            "nullable": true
          },
          {
            "name": "created_at",
            "type": "TIMESTAMP"
          },
          {
            "name": "updated_at",
            "type": "TIMESTAMP",
            "nullable": true
          }
        ],
        "indexes": [
          "slug"
        ]
      },
      {
        "name": "organization_members",
        "columns": [
          {
            "name": "id",
            "type": "UUID",
            "pk": true
          },
          {
            "name": "organization_id",
            "type": "UUID",
            "fk": "organizations.id"
          },
          {
            "name": "email",
            "type": "VARCHAR(255)"
          },
          {
            "name": "password_hash",
            "type": "VARCHAR(255)"
          },
          {
            "name": "name",
            "type": "VARCHAR(100)"
          },
          {
            "name": "role",
            "type": "VARCHAR(20)"
          },
          {
            "name": "email_verified",
            "type": "BOOLEAN",
            "default": false
          },
          {
            "name": "status",
            "type": "VARCHAR(20)",
            "default": "ACTIVE"
          },
          {
            "name": "last_login_at",
            "type": "TIMESTAMP",
            "nullable": true
          },
          {
            "name": "created_at",
            "type": "TIMESTAMP"
          },
          {
            "name": "updated_at",
            "type": "TIMESTAMP",
            "nullable": true
          }
        ],
        "constraints": [
          "UNIQUE (organization_id, email)"
        ],
        "indexes": [
          "organization_id",
          "email"
        ]
      },
      {
        "name": "organization_invitations",
        "columns": [
          {
            "name": "id",
            "type": "UUID",
            "pk": true
          },
          {
            "name": "organization_id",
            "type": "UUID",
            "fk": "organizations.id"
          },
          {
            "name": "email",
            "type": "VARCHAR(255)"
          },
          {
            "name": "role",
            "type": "VARCHAR(20)"
          },
          {
            "name": "token",
            "type": "VARCHAR(255)",
            "unique": true
          },
          {
            "name": "invited_by",
            "type": "UUID",
            "fk": "organization_members.id",
            "nullable": true
          },
          {
            "name": "expires_at",
            "type": "TIMESTAMP"
          },
          {
            "name": "created_at",
            "type": "TIMESTAMP"
          }
        ],
        "indexes": [
          "organization_id",
          "token"
        ]
      },
      {
        "name": "projects",
        "columns": [
          {
            "name": "id",
            "type": "UUID",
            "pk": true
          },
          {
            "name": "organization_id",
            "type": "UUID",
            "fk": "organizations.id"
          },
          {
            "name": "name",
            "type": "VARCHAR(100)"
          },
          {
            "name": "slug",
            "type": "VARCHAR(50)"
          },
          {
            "name": "description",
            "type": "TEXT",
            "nullable": true
          },
          {
            "name": "status",
            "type": "VARCHAR(20)",
            "default": "ACTIVE"
          },
          {
            "name": "created_at",
            "type": "TIMESTAMP"
          },
          {
            "name": "created_by",
            "type": "UUID",
            "fk": "organization_members.id",
            "nullable": true
          }
        ],
        "constraints": [
          "UNIQUE (organization_id, slug)"
        ],
        "indexes": [
          "organization_id",
          "slug"
        ]
      },
      {
        "name": "project_environments",
        "columns": [
          {
            "name": "id",
            "type": "UUID",
            "pk": true
          },
          {
            "name": "project_id",
            "type": "UUID",
            "fk": "projects.id"
          },
          {
            "name": "environment_type",
            "type": "VARCHAR(10)"
          },
          {
            "name": "created_at",
            "type": "TIMESTAMP"
          }
        ],
        "constraints": [
          "UNIQUE (project_id, environment_type)"
        ],
        "indexes": [
          "project_id",
          "environment_type"
        ]
      },
      {
        "name": "api_keys",
        "columns": [
          {
            "name": "id",
            "type": "UUID",
            "pk": true
          },
          {
            "name": "project_id",
            "type": "UUID",
            "fk": "projects.id"
          },
          {
            "name": "environment_id",
            "type": "UUID",
            "fk": "project_environments.id"
          },
          {
            "name": "name",
            "type": "VARCHAR(100)",
            "nullable": true
          },
          {
            "name": "key_hash",
            "type": "VARCHAR(255)",
            "unique": true
          },
          {
            "name": "key_prefix",
            "type": "VARCHAR(20)"
          },
          {
            "name": "last_used_at",
            "type": "TIMESTAMP",
            "nullable": true
          },
          {
            "name": "revoked_at",
            "type": "TIMESTAMP",
            "nullable": true
          },
          {
            "name": "created_at",
            "type": "TIMESTAMP"
          },
          {
            "name": "created_by",
            "type": "UUID",
            "fk": "organization_members.id",
            "nullable": true
          }
        ],
        "indexes": [
          "project_id",
          "environment_id",
          "key_prefix"
        ]
      },
      {
        "name": "users",
        "notes": "Existing table extended for project scoping",
        "columns": [
          {
            "name": "project_id",
            "type": "UUID",
            "fk": "projects.id",
            "nullable": true
          },
          {
            "name": "environment_id",
            "type": "UUID",
            "fk": "project_environments.id",
            "nullable": true
          }
        ],
        "indexes": [
          "project_id",
          "environment_id"
        ]
      }
    ]
  },
  "userStories": [
    {
      "id": "US-001",
      "title": "Organization onboarding",
      "description": "As a platform user, I want to create an organization and owner account so I can manage projects and billing.",
      "acceptanceCriteria": [
        "POST /api/v1/org/register creates organization and owner",
        "Organization slug is unique",
        "Owner receives org-member JWT on login",
        "Stripe customer id is stored at organization level",
        "Tests for org creation pass"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Org is the billing entity and top-level boundary."
    },
    {
      "id": "US-002",
      "title": "Org member management",
      "description": "As an org admin, I want to invite, accept, and manage org members so team access is controlled.",
      "acceptanceCriteria": [
        "Invite flow creates tokenized invitations with expiry",
        "Accepting invitation creates a member and consumes token",
        "Role changes are restricted to OWNER",
        "Cannot remove the last OWNER",
        "Member email is unique within org"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Org members are separate from end users."
    },
    {
      "id": "US-003",
      "title": "Project creation with fixed environments",
      "description": "As an org admin, I want projects to automatically include PROD and DEV environments so deployments are consistent.",
      "acceptanceCriteria": [
        "POST /api/v1/org/{orgId}/projects creates project",
        "Exactly two environments are created: PROD and DEV",
        "No additional environments can be created",
        "Project slug is unique within org",
        "API keys are generated for each environment"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Environment type is immutable."
    },
    {
      "id": "US-004",
      "title": "API key scoped SDK auth",
      "description": "As an SDK consumer, I want API keys to scope authentication to a project and environment.",
      "acceptanceCriteria": [
        "SDK routes require X-API-Key header",
        "API key resolves project and environment context",
        "Revoked keys are rejected",
        "Context is cleared after each request"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Context resolution occurs only for /api/v1/auth/** routes."
    },
    {
      "id": "US-005",
      "title": "Project-level isolation",
      "description": "As a platform operator, I want end users isolated per project so data never leaks across tenants.",
      "acceptanceCriteria": [
        "User repository filters by project context",
        "Cross-project access attempts return not found",
        "Isolation tests cover mixed project data"
      ],
      "priority": 5,
      "passes": false,
      "notes": "App-level filtering enforced in persistence adapters."
    },
    {
      "id": "US-006",
      "title": "Separate org and SDK auth flows",
      "description": "As a security requirement, org member auth and SDK auth must be isolated with separate filters and tokens.",
      "acceptanceCriteria": [
        "Org endpoints require org JWT",
        "SDK endpoints require API key + SDK JWT",
        "Org JWT cannot access SDK endpoints and vice versa"
      ],
      "priority": 6,
      "passes": false,
      "notes": "Separate filters are configured for /api/v1/org/** and /api/v1/auth/**."
    },
    {
      "id": "US-007",
      "title": "API key management",
      "description": "As an org admin, I want to list and rotate API keys per environment so compromised keys can be replaced.",
      "acceptanceCriteria": [
        "GET /api/v1/org/{orgId}/projects/{projectId}/keys lists key metadata",
        "POST /api/v1/org/{orgId}/projects/{projectId}/keys rotates key",
        "Old key is revoked and new key is returned once",
        "Keys are prefixed with pk_prod_ or pk_dev_"
      ],
      "priority": 7,
      "passes": false,
      "notes": "Key hashes are stored; raw key is returned only at creation."
    }
  ]
}
